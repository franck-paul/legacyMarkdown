"use strict";jsToolBar.prototype.elements.md_blocks={type:"combo",title:"block format",options:{none:"-- none --",nonebis:"- block format -",p:"Paragraph",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},markdown:{list:["nonebis","h3","h4","h5"],fn(e){switch(e){case"nonebis":this.textarea.focus();break;case"h3":this.encloseSelection("### ");break;case"h4":this.encloseSelection("#### ");break;case"h5":this.encloseSelection("##### ")}this.toolNodes.md_blocks.value="nonebis"}}},jsToolBar.prototype.elements.md_space0={type:"space",format:{markdown:!0}},jsToolBar.prototype.elements.md_strong={type:"button",title:"Strong emphasis",icon:"index.php?pf=formatting-markdown/img/bt_strong.svg",fn:{markdown(){this.singleTag("**")}}},jsToolBar.prototype.elements.md_em={type:"button",title:"Emphasis",icon:"index.php?pf=formatting-markdown/img/bt_em.svg",fn:{markdown(){this.singleTag("*")}}},jsToolBar.prototype.elements.md_ins={type:"button",title:"Inserted",icon:"index.php?pf=formatting-markdown/img/bt_ins.svg",fn:{markdown(){this.singleTag("<ins>","</ins>")}}},jsToolBar.prototype.elements.md_del={type:"button",title:"Deleted",icon:"index.php?pf=formatting-markdown/img/bt_del.svg",fn:{markdown(){this.singleTag("<del>","</del>")}}},jsToolBar.prototype.elements.md_quote={type:"button",title:"Inline quote",icon:"index.php?pf=formatting-markdown/img/bt_quote.svg",fn:{},cite_prompt:"Source URL:",lang_prompt:"Language:",prompt(e="",t=""){return null===(e=window.prompt(this.elements.md_quote.cite_prompt,e))||null===(t=window.prompt(this.elements.md_quote.lang_prompt,t))?null:{cite:e,lang:t}}},jsToolBar.prototype.elements.md_quote.fn.markdown=function(){const e=this.elements.md_quote.prompt.call(this);if(null!==e){let t="<q";const o="</q>";t=e.cite?`${t} cite="${e.cite}"`:t,t=e.lang?`${t} lang="${e.lang}"`:t,t=`${t}>`,this.encloseSelection(t,o)}else this.textarea.focus()},jsToolBar.prototype.elements.md_code={type:"button",title:"Code",icon:"index.php?pf=formatting-markdown/img/bt_code.svg",fn:{markdown(){this.singleTag("`")}}},jsToolBar.prototype.elements.md_mark={type:"button",title:"Mark",icon:"index.php?pf=formatting-markdown/img/bt_mark.svg",fn:{markdown(){this.singleTag("<mark>","</mark>")}}},jsToolBar.prototype.elements.md_foreign={type:"button",title:"Foreign text",icon:"index.php?pf=formatting-markdown/img/bt_foreign.svg",fn:{},lang_prompt:"Language:",default_lang:"en",prompt(e=""){return e=e||this.elements.md_foreign.default_lang,window.prompt(this.elements.md_foreign.lang_prompt,e)}},jsToolBar.prototype.elements.md_foreign.fn.markdown=function(){const e=this.elements.md_foreign.prompt.call(this);if(null!==e){let t="<i";const o="</i>";t=e?`${t} lang="${e}">`:`${t}>`,this.encloseSelection(t,o)}else this.textarea.focus()},jsToolBar.prototype.elements.md_space1={type:"space",format:{markdown:!0}},jsToolBar.prototype.elements.md_br={type:"button",title:"Line break",icon:"index.php?pf=formatting-markdown/img/bt_br.svg",fn:{markdown(){this.encloseSelection("  \n","")}}},jsToolBar.prototype.elements.md_space2={type:"space",format:{markdown:!0}},jsToolBar.prototype.elements.md_blockquote={type:"button",title:"Blockquote",icon:"index.php?pf=formatting-markdown/img/bt_bquote.svg",fn:{markdown(){this.encloseSelection("\n","",(e=>`> ${(e=e.replace(/\r/g,"")).replace(/\n/g,"\n> ")}`))}}},jsToolBar.prototype.elements.md_pre={type:"button",title:"Preformated text",icon:"index.php?pf=formatting-markdown/img/bt_pre.svg",fn:{markdown(){this.encloseSelection("<pre>\n","\n</pre>")}}},jsToolBar.prototype.elements.md_ul={type:"button",title:"Unordered list",icon:"index.php?pf=formatting-markdown/img/bt_ul.svg",fn:{markdown(){this.encloseSelection("","",(e=>`* ${(e=e.replace(/\r/g,"")).replace(/\n/g,"\n* ")}`))}}},jsToolBar.prototype.elements.md_ol={type:"button",title:"Ordered list",icon:"index.php?pf=formatting-markdown/img/bt_ol.svg",fn:{markdown(){this.encloseSelection("","",(e=>`1. ${(e=e.replace(/\r/g,"")).replace(/\n/g,"\n1. ")}`))}}},jsToolBar.prototype.elements.md_details={type:"button",title:"Details block",icon:"index.php?pf=formatting-markdown/img/bt_details.svg",fn:{},title_prompt:"Summary:",default_title:"",prompt(e=""){return e=e||this.elements.md_details.default_title,window.prompt(this.elements.md_details.title_prompt,e)}},jsToolBar.prototype.elements.md_details.fn.markdown=function(){const e=this.elements.md_details.prompt.call(this);if(null!==e){let t="<details>\n";const o="\n</details>";e&&(t=`${t}<summary>${e}</summary>\n`),this.encloseSelection(t,o)}else this.textarea.focus()},jsToolBar.prototype.elements.md_aside={type:"button",title:"Aside",icon:"index.php?pf=formatting-markdown/img/bt_aside.svg",fn:{markdown(){this.encloseSelection("<aside>\n","\n</aside>")}}},jsToolBar.prototype.elements.md_space3={type:"space",format:{markdown:!0}},jsToolBar.prototype.elements.md_link={type:"button",title:"Link",icon:"index.php?pf=formatting-markdown/img/bt_link.svg",fn:{},href_prompt:"Please give URL:",title_prompt:"Title for this URL:",lang_prompt:"Language:",default_title:"",default_lang:"",prompt(e="",t="",o=""){return t=t||this.elements.md_link.default_title,o=o||this.elements.md_link.default_lang,(e=window.prompt(this.elements.md_link.href_prompt,e))?null===(t=window.prompt(this.elements.md_link.title_prompt,t))||null===(o=window.prompt(this.elements.md_link.lang_prompt,o))?null:{href:this.stripBaseURL(e),title:t,lang:o}:null}},jsToolBar.prototype.elements.md_link.fn.markdown=function(){const e=this.elements.md_link.prompt.call(this);if(null!==e&&""!==e){const t="[";let o=`](${e.href}`;e.title&&(o=`${o} "${e.title}"`),o=`${o})`,e.lang&&(o=`${o}{hreflang=${e.lang}}`),this.encloseSelection(t,o)}else this.textarea.focus()},jsToolBar.prototype.elements.md_img={type:"button",title:"External image",icon:"index.php?pf=formatting-markdown/img/bt_img.svg",fn:{},src_prompt:"Please give image URL:",title_prompt:"Title for this image:",default_title:"",prompt(e="",t=""){return t=t||this.elements.md_img.default_title,(e=window.prompt(this.elements.md_img.src_prompt,e))?null===(t=window.prompt(this.elements.md_img.title_prompt,t))?null:{src:this.stripBaseURL(e),title:t}:null}},jsToolBar.prototype.elements.md_img.fn.markdown=function(){const e=this.elements.md_img.prompt.call(this);if(null!==e&&""!==e){const t="![";let o=`](${e.src}`;e.title&&(o=`${o} "${e.title}"`),o=`${o})`,this.encloseSelection(t,o)}else this.textarea.focus()},jsToolBar.prototype.elements.md_img_select={type:"button",title:"Image chooser",icon:"index.php?pf=formatting-markdown/img/bt_img_select.svg",fn:{},fncall:{},open_url:"media.php?popup=1&plugin_id=dcLegacyEditor",data:{},popup(){window.the_toolbar=this,this.elements.md_img_select.data={},window.open(this.elements.md_img_select.open_url,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no")}},jsToolBar.prototype.elements.md_img_select.fn.markdown=function(){this.elements.md_img_select.popup.call(this)},jsToolBar.prototype.elements.img_select.fncall.markdown=function(){const e=this.elements.img_select.data;e&&void 0!==e.src?this.encloseSelection("","",(t=>{const o={left:"float: left; margin: 0 1em 1em 0;",right:"float: right; margin: 0 0 1em 1em;",center:"margin: 0 auto; display: table;"},n=(t||e.title).replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;"),l=""!==e.description&&e.description.replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;");let i=`<img src="${e.src}" alt="${n}"`,s="<figure";const a=l?`<figcaption>${l}</figcaption>\n`:"";if(l&&(i=`${i} title="${l}"`),e.alignment in o&&(l?s=`${s} style="${o[e.alignment]}"`:i=`${i} style="${o[e.alignment]}"`),i=`${i} />`,s=`${s}>`,e.link){const t=n?` title="${n.replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;")}"`:"";i=`<a href="${e.url}"${t}>${i}</a>`}return l?`${s}\n${i}\n${a}</figure>`:i})):this.textarea.focus()},jsToolBar.prototype.elements.mp3_insert.fncall.markdown=function(){const e=this.elements.mp3_insert.data;null!=e.player&&this.encloseSelection("","",(()=>`\n${e.player}\n`))},jsToolBar.prototype.elements.flv_insert.fncall.markdown=function(){const e=this.elements.flv_insert.data;null!=e.player&&this.encloseSelection("","",(()=>`\n${e.player}\n`))},jsToolBar.prototype.elements.md_post_link={type:"button",title:"Link to an entry",icon:"index.php?pf=formatting-markdown/img/bt_post.svg",fn:{},open_url:"popup_posts.php?plugin_id=dcLegacyEditor",data:{},popup(){window.the_toolbar=this,this.elements.link.data={},window.open(this.elements.md_post_link.open_url,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no")}},jsToolBar.prototype.elements.md_post_link.fn.markdown=function(){this.elements.md_post_link.popup.call(this)},jsToolBar.prototype.elements.link.fncall.markdown=function(){const e=this.elements.link.data;if(e&&void 0!==e.href){const t="[",o=`](${e.href}${e.title?` "${e.title}"`:""})`;this.encloseSelection(t,o)}else this.textarea.focus()},jsToolBar.prototype.elements.md_footnote={type:"button",title:"Footnote",icon:"index.php?pf=formatting-markdown/img/bt_footnote.svg",fn:{markdown(){let e=0;const t=this.textarea.selectionStart,o=this.textarea.selectionEnd,n=this.textarea.value.substring(t,o),l=[...this.textarea.value.matchAll(/\[\^([0-9]*)\]/g)];l.length>0&&(e=Math.max(...l.map((e=>parseInt(e[1]))))),e+=1;const i=`[^${e}]`;this.textarea.value=this.textarea.value.substring(0,t)+i+this.textarea.value.substring(o),this.textarea.value=`${this.textarea.value}\n${i}: ${n}`,this.textarea.setSelectionRange(t+i.length,t+i.length),this.textarea.focus()}}},jsToolBar.prototype.elements.md_space4={type:"space",format:{markdown:!0}},jsToolBar.prototype.elements.md_preview={type:"button",title:"Preview",icon:"index.php?pf=formatting-markdown/img/bt_preview.svg",fn:{markdown(){dotclear.services("markdownConvert",(e=>{try{const t=JSON.parse(e);if(!t?.success)return void console.log(dotclear.debug&&t?.message?t.message:"Dotclear REST server error");t?.payload.ret&&$.magnificPopup.open({items:{src:`<div class="md_preview"><div class="md_markup">${t.payload.html}</div></div>`,type:"inline"}})}catch(e){console.log(e)}}),(e=>{console.log(e)}),!1,{json:1,md:this.textarea.value})}}},dotclear.mergeDeep(jsToolBar.prototype.elements,dotclear.getData("formatting_markdown"));
