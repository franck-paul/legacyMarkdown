"use strict";dotclear.md_options=dotclear.getData("md_options"),jsToolBar.prototype.elements.md_blocks={type:"combo",title:"block format",options:{none:"-- none --",nonebis:"- block format -",p:"Paragraph",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},markdown:{list:["nonebis","h3","h4","h5"],fn(e){switch(e){case"nonebis":this.textarea.focus();break;case"h3":this.encloseSelection("### ");break;case"h4":this.encloseSelection("#### ");break;case"h5":this.encloseSelection("##### ")}this.toolNodes.md_blocks.value="nonebis"}}},jsToolBar.prototype.elements.md_space0={type:"space",format:{markdown:!0}},jsToolBar.prototype.elements.md_strong={type:"button",title:"Strong emphasis",shortkey:"KeyB",shortkey_name:"B",fn:{markdown(){this.singleTag("**")}}},jsToolBar.prototype.elements.md_em={type:"button",title:"Emphasis",shortkey:"KeyI",shortkey_name:"I",fn:{markdown(){this.singleTag("*")}}},jsToolBar.prototype.elements.md_ins={type:"button",title:"Inserted",shortkey:"KeyU",shortkey_name:"U",fn:{markdown(){this.singleTag("<ins>","</ins>")}}},jsToolBar.prototype.elements.md_del={type:"button",title:"Deleted",shortkey:"KeyD",shortkey_name:"D",fn:{markdown(){this.singleTag("<del>","</del>")}}},jsToolBar.prototype.elements.md_quote={type:"button",title:"Inline quote",fn:{},cite_prompt:"Source URL:",lang_prompt:"Language:",prompt(e="",t=""){return null===(e=window.prompt(this.elements.md_quote.cite_prompt,e))||null===(t=window.prompt(this.elements.md_quote.lang_prompt,t))?null:{cite:e,lang:t}}},jsToolBar.prototype.elements.md_quote.fn.markdown=function(){const e=this.elements.md_quote.prompt.call(this);if(null!==e){let t="<q";const o="</q>";t=e.cite?`${t} cite="${e.cite}"`:t,t=e.lang?`${t} lang="${e.lang}"`:t,t=`${t}>`,this.encloseSelection(t,o)}else this.textarea.focus()},jsToolBar.prototype.elements.md_code={type:"button",title:"Code",fn:{markdown(){this.singleTag("`")}}},jsToolBar.prototype.elements.md_mark={type:"button",title:"Mark",fn:{markdown(){this.singleTag("<mark>","</mark>")}}},jsToolBar.prototype.elements.md_foreign={type:"button",title:"Foreign text",fn:{},lang_prompt:"Language:",default_lang:"en",prompt(e=""){return e=e||this.elements.md_foreign.default_lang,window.prompt(this.elements.md_foreign.lang_prompt,e)}},jsToolBar.prototype.elements.md_foreign.fn.markdown=function(){const e=this.elements.md_foreign.prompt.call(this);if(null!==e){let t="<i";const o="</i>";t=e?`${t} lang="${e}">`:`${t}>`,this.encloseSelection(t,o)}else this.textarea.focus()},jsToolBar.prototype.elements.md_space1={type:"space",format:{markdown:!0}},jsToolBar.prototype.elements.md_br={type:"button",title:"Line break",fn:{markdown(){this.encloseSelection("  \n","")}}},jsToolBar.prototype.elements.md_space2={type:"space",format:{markdown:!0}},jsToolBar.prototype.elements.md_blockquote={type:"button",title:"Blockquote",fn:{markdown(){this.encloseSelection("\n","",(e=>`> ${(e=e.replace(/\r/g,"")).replace(/\n/g,"\n> ")}`))}}},jsToolBar.prototype.elements.md_pre={type:"button",title:"Preformated text",fn:{markdown(){this.encloseSelection("<pre>\n","\n</pre>")}}},jsToolBar.prototype.elements.md_ul={type:"button",title:"Unordered list",fn:{markdown(){this.encloseSelection("","",(e=>`* ${(e=e.replace(/\r/g,"")).replace(/\n/g,"\n* ")}`))}}},jsToolBar.prototype.elements.md_ol={type:"button",title:"Ordered list",fn:{markdown(){this.encloseSelection("","",(e=>`1. ${(e=e.replace(/\r/g,"")).replace(/\n/g,"\n1. ")}`))}}},jsToolBar.prototype.elements.md_details={type:"button",title:"Details block",fn:{},title_prompt:"Summary:",default_title:"",prompt(e=""){return e=e||this.elements.md_details.default_title,window.prompt(this.elements.md_details.title_prompt,e)}},jsToolBar.prototype.elements.md_details.fn.markdown=function(){const e=this.elements.md_details.prompt.call(this);if(null!==e){let t="<details>\n";const o="\n</details>";e&&(t=`${t}<summary>${e}</summary>\n`),this.encloseSelection(t,o)}else this.textarea.focus()},jsToolBar.prototype.elements.md_aside={type:"button",title:"Aside",fn:{markdown(){this.encloseSelection("<aside>\n","\n</aside>")}}},jsToolBar.prototype.elements.md_space3={type:"space",format:{markdown:!0}},jsToolBar.prototype.elements.md_link={type:"button",title:"Link",shortkey:"KeyL",shortkey_name:"L",fn:{},href_prompt:"Please give URL:",title_prompt:"Title for this URL:",lang_prompt:"Language:",default_title:"",default_lang:"",prompt(e="",t="",o=""){return t=t||this.elements.md_link.default_title,o=o||this.elements.md_link.default_lang,(e=window.prompt(this.elements.md_link.href_prompt,e))?null===(t=window.prompt(this.elements.md_link.title_prompt,t))||null===(o=window.prompt(this.elements.md_link.lang_prompt,o))?null:{href:this.stripBaseURL(e),title:t,lang:o}:null}},jsToolBar.prototype.elements.md_link.fn.markdown=function(){const e=this.elements.md_link.prompt.call(this);if(null!==e&&""!==e){const t="[";let o=`](${e.href}`;e.title&&(o=`${o} "${e.title}"`),o=`${o})`,e.lang&&(o=`${o}{hreflang=${e.lang}}`),this.encloseSelection(t,o)}else this.textarea.focus()},jsToolBar.prototype.elements.md_img={type:"button",title:"External image",fn:{},src_prompt:"Please give image URL:",title_prompt:"Title for this image:",default_title:"",prompt(e="",t=""){return t=t||this.elements.md_img.default_title,(e=window.prompt(this.elements.md_img.src_prompt,e))?null===(t=window.prompt(this.elements.md_img.title_prompt,t))?null:{src:this.stripBaseURL(e),title:t}:null}},jsToolBar.prototype.elements.md_img.fn.markdown=function(){const e=this.elements.md_img.prompt.call(this);if(null!==e&&""!==e){const t="![";let o=`](${e.src}`;e.title&&(o=`${o} "${e.title}"`),o=`${o})`,this.encloseSelection(t,o)}else this.textarea.focus()},jsToolBar.prototype.elements.md_img_select={type:"button",title:"Image chooser",shortkey:"KeyM",shortkey_name:"M",fn:{},fncall:{},data:{},popup(){window.the_toolbar=this,this.elements.md_img_select.data={},window.open(this.elements.md_img_select.open_url,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no")}},jsToolBar.prototype.elements.md_img_select.fn.markdown=function(){this.elements.md_img_select.popup.call(this)},jsToolBar.prototype.elements.img_select.fncall.markdown=function(){const e=this.elements.img_select.data;e&&void 0!==e.src?this.encloseSelection("","",(t=>{const o={left:dotclear.md_options.style.left,right:dotclear.md_options.style.right,center:dotclear.md_options.style.center},l=(t||e.title).replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;"),n=""!==e.description&&e.description.replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;");let s=`<img src="${e.src}" alt="${l}"`,r="<figure";const a=n?`<figcaption>${n}</figcaption>\n`:"";if(e.alignment in o&&(n?r=`${r} ${dotclear.md_options.style.class?"class":"style"}="${o[e.alignment]}"`:s=`${s} ${dotclear.md_options.style.class?"class":"style"}="${o[e.alignment]}"`),s=`${s} />`,r=`${r}>`,e.link){const t=l?` title="${l.replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;")}"`:"";s=`<a href="${e.url}"${t}>${s}</a>`}return n?`${r}\n${s}\n${a}</figure>`:s})):this.textarea.focus()},jsToolBar.prototype.elements.mp3_insert.fncall.markdown=function(){const e=this.elements.mp3_insert.data;null!=e.player&&this.encloseSelection("","",(()=>`\n${e.player}\n`))},jsToolBar.prototype.elements.flv_insert.fncall.markdown=function(){const e=this.elements.flv_insert.data;null!=e.player&&this.encloseSelection("","",(()=>`\n${e.player}\n`))},jsToolBar.prototype.elements.md_post_link={type:"button",title:"Link to an entry",shortkey:"KeyE",shortkey_name:"E",fn:{},data:{},popup(){window.the_toolbar=this,this.elements.link.data={},window.open(this.elements.md_post_link.open_url,"dc_popup","alwaysRaised=yes,dependent=yes,toolbar=yes,height=500,width=760,menubar=no,resizable=yes,scrollbars=yes,status=no")}},jsToolBar.prototype.elements.md_post_link.fn.markdown=function(){this.elements.md_post_link.popup.call(this)},jsToolBar.prototype.elements.link.fncall.markdown=function(){const e=this.elements.link.data;if(e&&void 0!==e.href){const t="[",o=`](${e.href}${e.title?` "${e.title}"`:""})`;this.encloseSelection(t,o)}else this.textarea.focus()},jsToolBar.prototype.elements.md_footnote={type:"button",title:"Footnote",shortkey:"KeyN",shortkey_name:"N",fn:{markdown(){let e=0;const t=this.textarea.selectionStart,o=this.textarea.selectionEnd,l=this.textarea.value.substring(t,o),n=[...this.textarea.value.matchAll(/\[\^([0-9]*)\]/g)];n.length>0&&(e=Math.max(...n.map((e=>parseInt(e[1]))))),e+=1;const s=`[^${e}]`;this.textarea.value=this.textarea.value.substring(0,t)+s+this.textarea.value.substring(o),this.textarea.value=`${this.textarea.value}\n${s}: ${l}`,this.textarea.setSelectionRange(t+s.length,t+s.length),this.textarea.focus()}}},jsToolBar.prototype.elements.md_space4={type:"space",format:{markdown:!0}},jsToolBar.prototype.elements.md_preview={type:"button",title:"Preview",shortkey:"KeyP",shortkey_name:"P",fn:{markdown(){dotclear.services("markdownConvert",(e=>{try{const t=JSON.parse(e);if(!t?.success)return void console.log(dotclear.debug&&t?.message?t.message:"Dotclear REST server error");t?.payload.ret&&$.magnificPopup.open({items:{src:`<div class="md_preview"><div class="md_markup">${t.payload.html}</div></div>`,type:"inline"}})}catch(e){console.log(e)}}),(e=>{console.log(e)}),!1,{json:1,md:this.textarea.value})}}},dotclear.mergeDeep(jsToolBar.prototype.elements,dotclear.getData("md_editor"));
